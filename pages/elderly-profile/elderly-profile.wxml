<!-- è€äººç«¯ä¸“ç”¨ä¸ªäººä¸­å¿ƒé¡µé¢ -->
<view class="page-container elderly-profile">
  
  <!-- ç»Ÿä¸€å¯¼èˆªæ  -->
  <TopNavBar 
    title="ä¸ªäººä¸­å¿ƒ" 
    isElderly="{{true}}"
    showLogout="{{true}}"
    bind:logout="logout"
  />
  
  <!-- å†…å®¹åŒºåŸŸ -->
  <scroll-view class="content" scroll-y="true">
    <!-- ä¸ªäººä¿¡æ¯å¡ç‰‡ - è€äººç«¯ä¸“ç”¨è®¾è®¡ -->
    <view class="profile-card elderly">
      <view class="profile-header">
        <view class="avatar-section">
          <t-avatar 
            size="large"
            class="avatar elderly"
          >
            {{getAvatarText()}}
          </t-avatar>
          <view class="health-status">
            <t-icon name="heart" size="24rpx" color="#4CAF50" />
            <text class="health-text">å¥åº·çŠ¶æ€è‰¯å¥½</text>
          </view>
        </view>
        <view class="user-info">
          <view class="username">{{getUserDisplayName()}}</view>
          <view class="user-tags">
            <t-tag 
              theme="warning" 
              variant="light" 
              size="medium"
              class="user-tag elderly"
            >
              è€äººç”¨æˆ·
            </t-tag>
            <t-tag 
              theme="{{userInfo && userInfo.isVerified ? 'success' : 'warning'}}" 
              variant="light" 
              size="small"
              class="verification-status"
            >
              <t-icon name="{{userInfo && userInfo.isVerified ? 'check-circle' : 'time'}}" size="20rpx" />
              {{userInfo && userInfo.isVerified ? 'å·²è®¤è¯' : 'æœªè®¤è¯'}}
            </t-tag>
          </view>
          <view class="user-contact">
            <block wx:if="{{userInfo}}">
              <t-icon name="mobile" size="24rpx" />
              {{userInfo.phone}} 
            </block>
            <block wx:else>
              åŠ è½½ä¸­...
            </block>
          </view>
        </view>
      </view>
      
      <!-- æ—¶é—´å¸ä½™é¢ -->
      <view class="balance-section">
        <view class="balance-card">
          <t-icon name="money-circle" size="48rpx" color="rgba(255,255,255,0.9)" />
          <view class="balance-info">
            <view class="balance-label">æˆ‘çš„æ—¶é—´å¸</view>
            <view class="balance-value">{{userInfo ? userInfo.timeCoins || 0 : 0}}</view>
          </view>
          <t-button 
            theme="default" 
            size="medium"
            class="recharge-btn" 
            bind:tap="goToRecharge"
          >
            <t-icon name="add" size="20rpx" />
            å……å€¼
          </t-button>
        </view>
      </view>
    </view>

    <!-- å®¶å±å…³è”å¡ç‰‡ -->
    <view class="relation-card elderly">
      <view class="card-header">
        <view class="card-title">
          <view class="title-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</view>
          <text>æˆ‘çš„å®¶å±</text>
        </view>
        <view class="relation-count">{{familyMembers.length}}äºº</view>
      </view>
      
      <view wx:if="{{familyMembers.length > 0}}" class="family-list">
        <view wx:for="{{familyMembers}}" wx:key="id" class="family-item">
          <view class="family-avatar">{{item.name.charAt(0)}}</view>
          <view class="family-info">
            <view class="family-name">{{item.name}}</view>
            <view class="family-relation">{{item.relation}} â€¢ {{item.phone}}</view>
          </view>
          <button class="contact-btn" bindtap="contactFamily" data-id="{{item.id}}">
            ğŸ“ è”ç³»
          </button>
        </view>
      </view>
      
      <view wx:else class="empty-family">
        <view class="empty-icon">ğŸ‘¥</view>
        <view class="empty-text">æš‚æ— å…³è”å®¶å±</view>
      </view>

      <view class="binding-section">
        <button class="binding-code-btn" bindtap="showBindingCode">
          <view class="btn-icon">ğŸ”—</view>
          <text>æŸ¥çœ‹æˆ‘çš„ç»‘å®šç </text>
        </button>
        <view class="binding-tip">å®¶å±å¯é€šè¿‡ç»‘å®šç å…³è”æ‚¨çš„è´¦æˆ·</view>
      </view>
    </view>

    <!-- å¿—æ„¿è€…å…³è”å¡ç‰‡ -->
    <view class="relation-card elderly">
      <view class="card-header">
        <view class="card-title">
          <view class="title-icon">ğŸ¤</view>
          <text>æˆ‘çš„å¿—æ„¿è€…</text>
        </view>
        <button class="bind-btn" bindtap="bindVolunteer">+ ç»‘å®š</button>
      </view>
      
      <view wx:if="{{volunteers.length > 0}}" class="volunteer-list">
        <view wx:for="{{volunteers}}" wx:key="id" class="volunteer-item">
          <view class="volunteer-avatar">{{item.name.charAt(0)}}</view>
          <view class="volunteer-info">
            <view class="volunteer-name">{{item.name}}</view>
            <view class="volunteer-desc">{{item.specialty}} â€¢ æœåŠ¡{{item.serviceCount}}æ¬¡</view>
          </view>
          <button class="contact-btn" bindtap="contactVolunteer" data-id="{{item.id}}">
            ğŸ’¬ è”ç³»
          </button>
        </view>
      </view>
      
      <view wx:else class="empty-volunteer">
        <view class="empty-icon">ğŸ¤</view>
        <view class="empty-text">æš‚æ— ç»‘å®šå¿—æ„¿è€…</view>
        <view class="empty-desc">ç»‘å®šä¸“å±å¿—æ„¿è€…ï¼Œè·å¾—æ›´å¥½çš„æœåŠ¡ä½“éªŒ</view>
      </view>
    </view>

    <!-- å¥åº·æ¡£æ¡ˆå¡ç‰‡ -->
    <view class="health-card elderly">
      <view class="card-header">
        <view class="card-title">
          <view class="title-icon">â¤ï¸</view>
          <text>å¥åº·æ¡£æ¡ˆ</text>
        </view>
        <button class="edit-btn" bindtap="editHealthInfo">ç¼–è¾‘</button>
      </view>
      
      <view class="health-summary">
        <view class="health-item">
          <view class="health-label">å¹´é¾„</view>
          <view class="health-value">{{userInfo ? userInfo.age || 'æœªè®¾ç½®' : 'åŠ è½½ä¸­'}}</view>
        </view>
        <view class="health-item">
          <view class="health-label">æ…¢æ€§ç–¾ç—…</view>
          <view class="health-value">{{healthInfo.chronicDiseases || 'æ— '}}</view>
        </view>
        <view class="health-item">
          <view class="health-label">è¿‡æ•å²</view>
          <view class="health-value">{{healthInfo.allergies || 'æ— '}}</view>
        </view>
        <view class="health-item">
          <view class="health-label">ç´§æ€¥è”ç³»äºº</view>
          <view class="health-value">{{healthInfo.emergencyContact || 'æœªè®¾ç½®'}}</view>
        </view>
      </view>
    </view>

    <!-- åŠŸèƒ½èœå• -->
    <view class="menu-card elderly">
      <view class="menu-item" bindtap="showSettings">
        <view class="menu-left">
          <view class="menu-icon">âš™ï¸</view>
          <view class="menu-text">ä¸ªäººåå¥½è®¾ç½®</view>
        </view>
        <view class="menu-arrow">â†’</view>
      </view>

      <view class="menu-item" bindtap="showEmergencyContacts">
        <view class="menu-left">
          <view class="menu-icon">ğŸš¨</view>
          <view class="menu-text">ç´§æ€¥è”ç³»æ–¹å¼</view>
        </view>
        <view class="menu-arrow">â†’</view>
      </view>

      <view class="menu-item" bindtap="showServiceHistory">
        <view class="menu-left">
          <view class="menu-icon">ğŸ“‹</view>
          <view class="menu-text">æœåŠ¡è®°å½•</view>
        </view>
        <view class="menu-arrow">â†’</view>
      </view>

      <view class="menu-item" bindtap="showHelp">
        <view class="menu-left">
          <view class="menu-icon">â“</view>
          <view class="menu-text">å¸®åŠ©ä¸­å¿ƒ</view>
        </view>
        <view class="menu-arrow">â†’</view>
      </view>

      <view class="menu-item" bindtap="showFeedback">
        <view class="menu-left">
          <view class="menu-icon">ğŸ’¬</view>
          <view class="menu-text">æ„è§åé¦ˆ</view>
        </view>
        <view class="menu-arrow">â†’</view>
      </view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view class="safe-area-bottom"></view>
  </scroll-view>

  <!-- åº•éƒ¨å¯¼èˆª -->
  <BottomNav isElderly="{{true}}" activeIndex="{{4}}" bind:nav-change="onNavChange" />
</view>




