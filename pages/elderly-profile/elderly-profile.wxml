<!-- 老人端专用个人中心页面 -->
<view class="page-container elderly-profile">
  
  <!-- 统一导航栏 -->
  <TopNavBar 
    title="个人中心" 
    isElderly="{{true}}"
    showLogout="{{true}}"
    bind:logout="logout"
  />
  
  <!-- 内容区域 -->
  <scroll-view class="content" scroll-y="true">
    <!-- 个人信息卡片 - 老人端专用设计 -->
    <view class="profile-card elderly">
      <view class="profile-header">
        <view class="avatar-section">
          <t-avatar 
            size="large"
            class="avatar elderly"
          >
            {{getAvatarText()}}
          </t-avatar>
          <view class="health-status">
            <t-icon name="heart" size="24rpx" color="#4CAF50" />
            <text class="health-text">健康状态良好</text>
          </view>
        </view>
        <view class="user-info">
          <view class="username">{{getUserDisplayName()}}</view>
          <view class="user-tags">
            <t-tag 
              theme="warning" 
              variant="light" 
              size="medium"
              class="user-tag elderly"
            >
              老人用户
            </t-tag>
            <t-tag 
              theme="{{userInfo && userInfo.isVerified ? 'success' : 'warning'}}" 
              variant="light" 
              size="small"
              class="verification-status"
            >
              <t-icon name="{{userInfo && userInfo.isVerified ? 'check-circle' : 'time'}}" size="20rpx" />
              {{userInfo && userInfo.isVerified ? '已认证' : '未认证'}}
            </t-tag>
          </view>
          <view class="user-contact">
            <block wx:if="{{userInfo}}">
              <t-icon name="mobile" size="24rpx" />
              {{userInfo.phone}} 
            </block>
            <block wx:else>
              加载中...
            </block>
          </view>
        </view>
      </view>
      
      <!-- 时间币余额 -->
      <view class="balance-section">
        <view class="balance-card">
          <t-icon name="money-circle" size="48rpx" color="rgba(255,255,255,0.9)" />
          <view class="balance-info">
            <view class="balance-label">我的时间币</view>
            <view class="balance-value">{{userInfo ? userInfo.timeCoins || 0 : 0}}</view>
          </view>
          <t-button 
            theme="default" 
            size="medium"
            class="recharge-btn" 
            bind:tap="goToRecharge"
          >
            <t-icon name="add" size="20rpx" />
            充值
          </t-button>
        </view>
      </view>
    </view>

    <!-- 家属关联卡片 -->
    <view class="relation-card elderly">
      <view class="card-header">
        <view class="card-title">
          <view class="title-icon">👨‍👩‍👧‍👦</view>
          <text>我的家属</text>
        </view>
        <view class="relation-count">{{familyMembers.length}}人</view>
      </view>
      
      <view wx:if="{{familyMembers.length > 0}}" class="family-list">
        <view wx:for="{{familyMembers}}" wx:key="id" class="family-item">
          <view class="family-avatar">{{item.name.charAt(0)}}</view>
          <view class="family-info">
            <view class="family-name">{{item.name}}</view>
            <view class="family-relation">{{item.relation}} • {{item.phone}}</view>
          </view>
          <button class="contact-btn" bindtap="contactFamily" data-id="{{item.id}}">
            📞 联系
          </button>
        </view>
      </view>
      
      <view wx:else class="empty-family">
        <view class="empty-icon">👥</view>
        <view class="empty-text">暂无关联家属</view>
      </view>

      <view class="binding-section">
        <button class="binding-code-btn" bindtap="showBindingCode">
          <view class="btn-icon">🔗</view>
          <text>查看我的绑定码</text>
        </button>
        <view class="binding-tip">家属可通过绑定码关联您的账户</view>
      </view>
    </view>

    <!-- 志愿者关联卡片 -->
    <view class="relation-card elderly">
      <view class="card-header">
        <view class="card-title">
          <view class="title-icon">🤝</view>
          <text>我的志愿者</text>
        </view>
        <button class="bind-btn" bindtap="bindVolunteer">+ 绑定</button>
      </view>
      
      <view wx:if="{{volunteers.length > 0}}" class="volunteer-list">
        <view wx:for="{{volunteers}}" wx:key="id" class="volunteer-item">
          <view class="volunteer-avatar">{{item.name.charAt(0)}}</view>
          <view class="volunteer-info">
            <view class="volunteer-name">{{item.name}}</view>
            <view class="volunteer-desc">{{item.specialty}} • 服务{{item.serviceCount}}次</view>
          </view>
          <button class="contact-btn" bindtap="contactVolunteer" data-id="{{item.id}}">
            💬 联系
          </button>
        </view>
      </view>
      
      <view wx:else class="empty-volunteer">
        <view class="empty-icon">🤝</view>
        <view class="empty-text">暂无绑定志愿者</view>
        <view class="empty-desc">绑定专属志愿者，获得更好的服务体验</view>
      </view>
    </view>

    <!-- 健康档案卡片 -->
    <view class="health-card elderly">
      <view class="card-header">
        <view class="card-title">
          <view class="title-icon">❤️</view>
          <text>健康档案</text>
        </view>
        <button class="edit-btn" bindtap="editHealthInfo">编辑</button>
      </view>
      
      <view class="health-summary">
        <view class="health-item">
          <view class="health-label">年龄</view>
          <view class="health-value">{{userInfo ? userInfo.age || '未设置' : '加载中'}}</view>
        </view>
        <view class="health-item">
          <view class="health-label">慢性疾病</view>
          <view class="health-value">{{healthInfo.chronicDiseases || '无'}}</view>
        </view>
        <view class="health-item">
          <view class="health-label">过敏史</view>
          <view class="health-value">{{healthInfo.allergies || '无'}}</view>
        </view>
        <view class="health-item">
          <view class="health-label">紧急联系人</view>
          <view class="health-value">{{healthInfo.emergencyContact || '未设置'}}</view>
        </view>
      </view>
    </view>

    <!-- 功能菜单 -->
    <view class="menu-card elderly">
      <view class="menu-item" bindtap="showSettings">
        <view class="menu-left">
          <view class="menu-icon">⚙️</view>
          <view class="menu-text">个人偏好设置</view>
        </view>
        <view class="menu-arrow">→</view>
      </view>

      <view class="menu-item" bindtap="showEmergencyContacts">
        <view class="menu-left">
          <view class="menu-icon">🚨</view>
          <view class="menu-text">紧急联系方式</view>
        </view>
        <view class="menu-arrow">→</view>
      </view>

      <view class="menu-item" bindtap="showServiceHistory">
        <view class="menu-left">
          <view class="menu-icon">📋</view>
          <view class="menu-text">服务记录</view>
        </view>
        <view class="menu-arrow">→</view>
      </view>

      <view class="menu-item" bindtap="showHelp">
        <view class="menu-left">
          <view class="menu-icon">❓</view>
          <view class="menu-text">帮助中心</view>
        </view>
        <view class="menu-arrow">→</view>
      </view>

      <view class="menu-item" bindtap="showFeedback">
        <view class="menu-left">
          <view class="menu-icon">💬</view>
          <view class="menu-text">意见反馈</view>
        </view>
        <view class="menu-arrow">→</view>
      </view>
    </view>

    <!-- 底部安全区域 -->
    <view class="safe-area-bottom"></view>
  </scroll-view>

  <!-- 底部导航 -->
  <BottomNav isElderly="{{true}}" activeIndex="{{4}}" bind:nav-change="onNavChange" />
</view>




