<!-- 发布服务需求页面 -->
<view class="page-container">
  
  <!-- 统一导航栏 -->
  <TopNavBar 
    title="{{getPageTitle()}}" 
    isElderly="{{isElderly}}"
    showBack="{{true}}"
    bind:back="onBackClick"
    showAction="{{true}}"
    actionText="退出"
    bind:action="logout"
  />
  
  <!-- 内容区域 -->
  <scroll-view class="content" scroll-y="true">
    <!-- 家属端代为发布页面 -->
    <block wx:if="{{!isElderly}}">
      <!-- 提示卡片 -->
      <view class="tip-card">
        <view class="tip-title">💝 为{{getUserDisplayName()}}发布需求</view>
        <view class="tip-subtitle">帮助{{getUserDisplayName()}}发布服务需求，让社区志愿者提供帮助</view>
      </view>

      <!-- 表单 -->
      <view class="form-container">
        <view class="form-group">
          <view class="form-label">服务类型</view>
          <picker value="{{serviceTypeIndex}}" range="{{serviceTypes}}" bindchange="onServiceTypeChange">
            <view class="form-input picker">
              {{serviceTypes[serviceTypeIndex]}}
            </view>
          </picker>
        </view>

        <view class="form-group">
          <view class="form-label">服务描述</view>
          <textarea 
            value="{{serviceDescription}}" 
            class="form-input form-textarea" 
            placeholder="请详细描述需要的服务内容..."
            maxlength="500"
            bindinput="onServiceDescriptionInput"
          ></textarea>
        </view>

        <view class="form-group">
          <view class="form-label">服务时间</view>
          <picker 
            mode="multiSelector" 
            value="{{[dateIndex, timeIndex]}}" 
            range="{{[dateRange, timeRange]}}"
            bindchange="onDateTimeChange"
          >
            <view class="form-input picker">
              {{getSelectedDateTime()}}
            </view>
          </picker>
        </view>

        <view class="form-group">
          <view class="form-label">预计报酬（时间币）</view>
          <input 
            value="{{serviceReward}}" 
            class="form-input" 
            type="number" 
            placeholder="建议：买菜2币，清洁3币，就医4币"
            bindinput="onServiceRewardInput"
          />
        </view>

        <view class="form-group">
          <view class="form-label">服务地址</view>
          <picker value="{{addressIndex}}" range="{{addressOptions}}" bindchange="onAddressChange">
            <view class="form-input picker">
              {{addressOptions[addressIndex]}}
            </view>
          </picker>
          <input 
            wx:if="{{addressIndex === addressOptions.length - 1}}"
            value="{{customAddress}}"
            class="form-input custom-address" 
            type="text" 
            placeholder="请输入详细地址"
            bindinput="onCustomAddressInput"
          />
        </view>

        <view class="form-group">
          <view class="form-label">特殊要求</view>
          <textarea 
            value="{{specialRequirements}}" 
            class="form-input form-textarea" 
            placeholder="如有特殊要求请说明（可选）"
            maxlength="200"
            bindinput="onSpecialRequirementsInput"
          ></textarea>
        </view>

        <view class="form-group">
          <view class="form-label">联系方式</view>
          <input 
            value="{{contactPhone}}" 
            class="form-input" 
            type="text" 
            placeholder="{{getUserDisplayName()}}的手机号码"
            bindinput="onContactPhoneInput"
          />
        </view>

        <view class="form-group">
          <view class="form-label">紧急程度</view>
          <view class="urgency-options">
            <view 
              wx:for="{{urgencyOptions}}" 
              wx:key="index"
              class="urgency-option {{urgencyIndex === index ? 'active' : ''}}" 
              data-index="{{index}}"
              bindtap="selectUrgency"
            >
              <view class="urgency-icon">{{item.icon}}</view>
              <view class="urgency-text">{{item.text}}</view>
            </view>
          </view>
        </view>

        <!-- 预览卡片 -->
        <view class="preview-card">
          <view class="preview-title">📋 发布预览</view>
          <view class="preview-content">
            <view class="preview-item">
              <text class="preview-label">服务类型：</text>
              <text class="preview-value">{{serviceTypes[serviceTypeIndex]}}</text>
            </view>
            <view class="preview-item">
              <text class="preview-label">服务时间：</text>
              <text class="preview-value">{{getSelectedDateTime()}}</text>
            </view>
            <view class="preview-item">
              <text class="preview-label">预计报酬：</text>
              <text class="preview-value reward">{{serviceReward}}时间币</text>
            </view>
            <view class="preview-item">
              <text class="preview-label">紧急程度：</text>
              <text class="preview-value {{urgencyOptions[urgencyIndex].class}}">{{urgencyOptions[urgencyIndex].text}}</text>
            </view>
          </view>
        </view>

        <button class="submit-btn" bindtap="publishService" disabled="{{!isFormValid()}}">
          立即发布需求
        </button>
      </view>
    </block>

    <!-- 老人端语音发布页面 -->
    <block wx:elif="{{publishType === 'voice'}}">
      <view class="voice-container">
        <view class="voice-tip">
          <view class="voice-title">告诉我您需要什么帮助</view>
          <view class="voice-subtitle">按住按钮说话，我会帮您自动发布需求</view>
        </view>

        <view class="voice-button-container">
          <button 
            class="voice-button {{isRecording ? 'recording' : ''}}" 
            bindtouchstart="startRecording"
            bindtouchend="stopRecording"
            bindtouchcancel="stopRecording"
          >
            {{isRecording ? '🔴' : '🎤'}}
          </button>
          <view class="voice-status">{{voiceStatus}}</view>
        </view>

        <view class="quick-services">
          <view class="quick-title">常用服务</view>
          <view class="quick-actions-layout elderly">
            <!-- 第一行：两个按钮 -->
            <view class="quick-actions-row">
              <view class="quick-action-large elderly" bind:tap="quickPublish" data-type="买菜">
                <view class="action-icon-container">
                  <t-icon name="shop" size="64rpx" />
                </view>
                <view class="action-info">
                  <view class="action-title">买菜代购</view>
                </view>
              </view>
              <view class="quick-action-large elderly blue" bind:tap="quickPublish" data-type="清洁">
                <view class="action-icon-container">
                  <t-icon name="clear" size="64rpx" />
                </view>
                <view class="action-info">
                  <view class="action-title">家政清洁</view>
                </view>
              </view>
            </view>
            
            <!-- 第二行：两个按钮 -->
            <view class="quick-actions-row">
              <view class="quick-action-large elderly green" bind:tap="quickPublish" data-type="就医">
                <view class="action-icon-container">
                  <t-icon name="hospital" size="64rpx" />
                </view>
                <view class="action-info">
                  <view class="action-title">陪同就医</view>
                </view>
              </view>
              <view class="quick-action-large elderly pink" bind:tap="quickPublish" data-type="陪伴">
                <view class="action-icon-container">
                  <t-icon name="heart" size="64rpx" />
                </view>
                <view class="action-info">
                  <view class="action-title">情感陪伴</view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>

    <!-- 老人端手动填写页面 -->
    <block wx:elif="{{publishType === 'manual'}}">
      <!-- 提示卡片 -->
      <view class="tip-card elderly">
        <view class="tip-title">📝 发布服务需求</view>
        <view class="tip-subtitle">填写您需要的服务信息</view>
      </view>

      <!-- 表单 -->
      <view class="form-container elderly">
        <view class="form-group">
          <view class="form-label">服务类型</view>
          <picker value="{{serviceTypeIndex}}" range="{{serviceTypes}}" bindchange="onServiceTypeChange">
            <view class="form-input picker elderly">
              {{serviceTypes[serviceTypeIndex]}}
            </view>
          </picker>
        </view>

        <view class="form-group">
          <view class="form-label">我需要什么帮助</view>
          <textarea 
            value="{{serviceDescription}}" 
            class="form-input form-textarea elderly" 
            placeholder="请告诉我们您需要什么帮助..."
            maxlength="500"
            bindinput="onServiceDescriptionInput"
          ></textarea>
        </view>

        <view class="form-group">
          <view class="form-label">什么时候需要</view>
          <picker 
            mode="multiSelector" 
            value="{{[dateIndex, timeIndex]}}" 
            range="{{[dateRange, timeRange]}}"
            bindchange="onDateTimeChange"
          >
            <view class="form-input picker elderly">
              {{getSelectedDateTime()}}
            </view>
          </picker>
        </view>

        <view class="form-group">
          <view class="form-label">愿意支付（时间币）</view>
          <input 
            value="{{serviceReward}}" 
            class="form-input elderly" 
            type="number" 
            placeholder="建议：买菜2币，清洁3币，就医4币"
            bindinput="onServiceRewardInput"
          />
        </view>

        <button class="submit-btn elderly" bindtap="publishService">
          发布需求
        </button>
      </view>
    </block>
  </scroll-view>

  <!-- 底部导航 -->
  <BottomNav isElderly="{{isElderly}}" activeIndex="{{1}}" bind:nav-change="onNavChange" />
</view>