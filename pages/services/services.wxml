<view class="page">
  <!-- 统一导航栏 -->
  <TopNavBar 
    title="{{isElderly ? '找人帮忙' : '服务管理'}}"
    isElderly="{{isElderly}}"
    showBack="{{true}}"
    bind:back="goBack"
  />
  
  <!-- 内容区域 -->
  <scroll-view class="content {{isElderly ? 'elderly-ui' : 'family-ui'}}" scroll-y="true" enhanced="true" show-scrollbar="false">
    <!-- 家属端服务页面 -->
    <block wx:if="{{!isElderly}}">
      <!-- 接单大厅卡片 -->
      <view class="order-hall-card">
        <view class="order-hall-header">
          <view class="order-hall-info">
            <view class="order-hall-title">
              <t-icon name="assignment" size="36rpx" color="#0052D9" />
              接单大厅
            </view>
            <view class="order-hall-subtitle">发现附近的服务需求</view>
          </view>
          <t-badge count="{{12}}" offset="{{[8, 8]}}">
            <t-icon name="notification" size="56rpx" color="#0052D9" />
          </t-badge>
        </view>
        
        <t-grid column="{{3}}" border="{{false}}" class="order-hall-stats">
          <t-grid-item>
            <view class="order-stat">
              <view class="order-stat-number">12</view>
              <view class="order-stat-label">可接订单</view>
            </view>
          </t-grid-item>
          <t-grid-item>
            <view class="order-stat">
              <view class="order-stat-number">2.3km</view>
              <view class="order-stat-label">平均距离</view>
            </view>
          </t-grid-item>
          <t-grid-item>
            <view class="order-stat">
              <view class="order-stat-number">3.2</view>
              <view class="order-stat-label">平均报酬</view>
            </view>
          </t-grid-item>
        </t-grid>
        
        <t-button 
          theme="primary" 
          size="large"
          block
          class="order-hall-btn" 
          bind:tap="goToOrderHall"
        >
          进入接单大厅
        </t-button>
      </view>

      <!-- 服务统计 -->
      <t-grid column="{{4}}" border="{{false}}" class="stats-grid">
        <t-grid-item>
          <view class="stat-card">
            <t-icon name="time" size="32rpx" color="#0052D9" />
            <view class="stat-number">2</view>
            <view class="stat-label">进行中</view>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="stat-card">
            <t-icon name="check-circle" size="32rpx" color="#00A870" />
            <view class="stat-number">12</view>
            <view class="stat-label">已完成</view>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="stat-card">
            <t-icon name="clock" size="32rpx" color="#ED7B2F" />
            <view class="stat-number">0</view>
            <view class="stat-label">待确认</view>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="stat-card">
            <t-icon name="star" size="32rpx" color="#FFB800" />
            <view class="stat-number">5.0</view>
            <view class="stat-label">平均评分</view>
          </view>
        </t-grid-item>
      </t-grid>

      <!-- 进行中的服务 -->
      <view class="services-section">
        <t-divider>
          <t-icon name="time" size="24rpx" color="#0052D9" />
          进行中的服务
        </t-divider>
        
        <view class="service-card active">
          <view class="service-header">
            <view class="service-info">
              <view class="service-title">
                <t-icon name="shop" size="28rpx" color="#0052D9" />
                买菜代购
              </view>
              <view class="service-volunteer">
                <t-icon name="user" size="20rpx" color="#666" />
                王阿姨 • 📞 139****8765
              </view>
            </view>
            <t-tag theme="primary" variant="light" size="small">进行中</t-tag>
          </view>
          
          <view class="service-description">需要购买蔬菜和水果，预计1小时完成</view>
          
          <view class="service-footer">
            <view class="service-time">
              <t-icon name="time" size="20rpx" color="#999" />
              今天 14:30 开始
            </view>
            <t-button theme="outline" size="small" bind:tap="contactVolunteer">
              联系志愿者
            </t-button>
          </view>
        </view>

        <view class="service-card active">
          <view class="service-header">
            <view class="service-info">
              <view class="service-title">
                <t-icon name="heart" size="28rpx" color="#0052D9" />
                情感陪伴
              </view>
              <view class="service-volunteer">
                <t-icon name="user" size="20rpx" color="#666" />
                李师傅 • 📞 136****2345
              </view>
            </view>
            <t-tag theme="primary" variant="light" size="small">进行中</t-tag>
          </view>
          
          <view class="service-description">陪妈妈聊天散步，分享生活趣事</view>
          
          <view class="service-footer">
            <view class="service-time">
              <t-icon name="time" size="20rpx" color="#999" />
              今天 15:00 开始
            </view>
            <t-button theme="outline" size="small" bind:tap="contactVolunteer">
              联系志愿者
            </t-button>
          </view>
        </view>
      </view>

      <!-- 最近完成的服务 -->
      <view class="services-section">
        <t-divider>
          <t-icon name="check-circle" size="24rpx" color="#00A870" />
          最近完成
        </t-divider>
        
        <view class="service-card completed">
          <view class="service-header">
            <view class="service-info">
              <view class="service-title">
                <t-icon name="hospital" size="28rpx" color="#00A870" />
                陪同就医
              </view>
              <view class="service-volunteer">
                <t-icon name="user" size="20rpx" color="#666" />
                张护士 • 📞 138****9876
              </view>
            </view>
            <t-tag theme="success" variant="light" size="small">已完成</t-tag>
          </view>
          
          <view class="service-description">陪同妈妈到医院复查，服务态度很好</view>
          
          <view class="service-footer">
            <view class="service-time">
              <t-icon name="time" size="20rpx" color="#999" />
              昨天 09:00 • 耗时3小时
            </view>
            <view class="service-rating">
              <view class="rating-stars">
                <t-icon name="star-filled" size="20rpx" color="#FFB800" wx:for="{{5}}" wx:key="index" />
              </view>
              <view class="rating-text">已评价</view>
            </view>
          </view>
        </view>
      </view>
    </block>

    <!-- 老人端服务页面 -->
    <block wx:else>
      <!-- 发布服务区域 -->
      <view class="publish-service-card elderly-card">
        <view class="publish-header">
          <t-icon name="edit" size="40rpx" color="#FF6B35" />
          <view class="publish-title">发布服务需求</view>
        </view>
        
        <view class="publish-subtitle">告诉我们您需要什么帮助</view>
        
        <view class="publish-buttons">
          <t-button 
            theme="primary" 
            size="large" 
            class="publish-btn primary"
            bind:tap="goToVoicePublish"
          >
            <t-icon name="sound" size="28rpx" />
            语音发布
          </t-button>
          <t-button 
            theme="default" 
            variant="outline"
            size="large" 
            class="publish-btn outline"
            bind:tap="goToManualPublish"
          >
            <t-icon name="edit-1" size="28rpx" />
            手动填写
          </t-button>
        </view>
        
        <view class="publish-tip">
          <t-icon name="lightbulb" size="24rpx" color="#FF6B35" />
          <view class="tip-content">语音发布更简单，AI助手会帮您自动整理需求信息</view>
        </view>
      </view>

      <!-- 服务统计 -->
      <t-grid column="{{4}}" border="{{false}}" class="stats-grid elderly">
        <t-grid-item>
          <view class="stat-card elderly">
            <t-icon name="time" size="32rpx" color="#FF6B35" />
            <view class="stat-content">
              <view class="stat-number">2</view>
              <view class="stat-label">进行中</view>
            </view>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="stat-card elderly">
            <t-icon name="check-circle" size="32rpx" color="#FF6B35" />
            <view class="stat-content">
              <view class="stat-number">12</view>
              <view class="stat-label">已完成</view>
            </view>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="stat-card elderly">
            <t-icon name="clock" size="32rpx" color="#FF6B35" />
            <view class="stat-content">
              <view class="stat-number">0</view>
              <view class="stat-label">待确认</view>
            </view>
          </view>
        </t-grid-item>
        <t-grid-item>
          <view class="stat-card elderly">
            <t-icon name="star" size="32rpx" color="#FF6B35" />
            <view class="stat-content">
              <view class="stat-number">5.0</view>
              <view class="stat-label">平均评分</view>
            </view>
          </view>
        </t-grid-item>
      </t-grid>

      <!-- 快捷发布 -->
      <view class="quick-actions-layout elderly">
        <!-- 第一行：两个按钮 -->
        <view class="quick-actions-row">
          <view class="quick-action-large elderly" bind:tap="quickPublish" data-service="买菜">
            <view class="action-icon-container">
              <t-icon name="shop" size="64rpx" />
            </view>
            <view class="action-info">
              <view class="action-title">买菜代购</view>
            </view>
          </view>
          <view class="quick-action-large elderly blue" bind:tap="quickPublish" data-service="清洁">
            <view class="action-icon-container">
              <t-icon name="clear" size="64rpx" />
            </view>
            <view class="action-info">
              <view class="action-title">家政清洁</view>
            </view>
          </view>
        </view>
        
        <!-- 第二行：两个按钮 -->
        <view class="quick-actions-row">
          <view class="quick-action-large elderly green" bind:tap="quickPublish" data-service="就医">
            <view class="action-icon-container">
              <t-icon name="hospital" size="64rpx" />
            </view>
            <view class="action-info">
              <view class="action-title">陪同就医</view>
            </view>
          </view>
          <view class="quick-action-large elderly pink" bind:tap="quickPublish" data-service="陪伴">
            <view class="action-icon-container">
              <t-icon name="heart" size="64rpx" />
            </view>
            <view class="action-info">
              <view class="action-title">情感陪伴</view>
            </view>
          </view>
        </view>
      </view>
    </block>
  </scroll-view>

  <!-- 底部导航 -->
  <BottomNav isElderly="{{isElderly}}" activeIndex="{{1}}" bind:nav-change="onNavChange" />
</view>